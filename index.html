
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>bobby.md</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #08090C;
    }
    canvas { display: block; }
  </style>
</head>
<body>
<canvas id="c"></canvas>
<script>
const PIXEL = 15;
const SCALE = 200 / 452;
const BG = '#08090C';

const FACE_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="452" height="452" viewBox="0 0 452 452" fill="none">
<path d="M265 351H188V335H265V351ZM188 335H173V319H188V335ZM279 335H265V319H279V335ZM280 117H311V133H326V273H311V303H265V287H188V303H142V273H127V133H142V117H173V102H280V117Z" fill="#9CA2BD"/>
<rect width="30" height="32" transform="matrix(1 0 0 -1 265 242)" fill="#08090C"/>
<rect width="30" height="32" transform="matrix(1 0 0 -1 158 242)" fill="#08090C"/>
<path d="M280 399H173V383H158V367H143V351H127V319H111V273H80V257H64V180H80V164H96V133H111V102H127V86H142V68H158V53H293V68H311V86H326V102H342V133H357V164H373V180H389V257H373V273H342V319H326V351H310V367H295V383H280V399ZM188 319H173V335H188V351H265V335H279V319H265V335H188V319H265V303H188V319ZM173 117H142V133H127V273H142V303H173V287H188V273H203V287H250V273H265V287H280V303H311V273H326V133H311V117H280V102H173V117Z" fill="#2F3550"/>
<rect width="77" height="16" transform="matrix(1 0 0 -1 188 319)" fill="white"/>
<rect width="60" height="15" transform="matrix(1 0 0 -1 143 195)" fill="#08090C"/>
<rect width="60" height="15" transform="matrix(1 0 0 -1 249 195)" fill="#08090C"/>
<rect width="15" height="32" transform="matrix(1 0 0 -1 143 242)" fill="white"/>
<rect width="15" height="32" transform="matrix(1 0 0 -1 188 242)" fill="white"/>
<rect width="15" height="32" transform="matrix(1 0 0 -1 250 242)" fill="white"/>
<rect width="15" height="32" transform="matrix(1 0 0 -1 295 242)" fill="white"/>
</svg>`;

const BLINK_SVG = `<svg xmlns="http://www.w3.org/2000/svg" width="452" height="452" viewBox="0 0 452 452" fill="none">
<path d="M265 351H188V335H265V351ZM188 335H173V319H188V335ZM279 335H265V319H279V335ZM280 117H311V133H326V273H311V303H265V287H188V303H142V273H127V133H142V117H173V102H280V117Z" fill="#9CA2BD"/>
<path d="M280 399H173V383H158V367H143V351H127V319H111V273H80V257H64V180H80V164H96V133H111V102H127V86H142V68H158V53H293V68H311V86H326V102H342V133H357V164H373V180H389V257H373V273H342V319H326V351H310V367H295V383H280V399ZM188 319H173V335H188V351H265V335H279V319H265V335H188V319H265V303H188V319ZM173 117H142V133H127V273H142V303H173V287H188V273H203V287H250V273H265V287H280V303H311V273H326V133H311V117H280V102H173V117Z" fill="#2F3550"/>
<rect width="77" height="16" transform="matrix(1 0 0 -1 188 319)" fill="white"/>
<rect width="60" height="15" transform="matrix(1 0 0 -1 143 195)" fill="#08090C"/>
<rect width="60" height="15" transform="matrix(1 0 0 -1 249 195)" fill="#08090C"/>
<rect x="143" y="220" width="60" height="4" fill="#2F3550"/>
<rect x="249" y="220" width="60" height="4" fill="#2F3550"/>
</svg>`;

function svgToImage(svgStr) {
  return new Promise(resolve => {
    const blob = new Blob([svgStr], { type: 'image/svg+xml' });
    const url = URL.createObjectURL(blob);
    const img = new Image();
    img.onload = () => { URL.revokeObjectURL(url); resolve(img); };
    img.src = url;
  });
}

function extractPixels(ctx, w, h, gridSize) {
  const data = ctx.getImageData(0, 0, w, h).data;
  const pixels = [];
  for (let y = 0; y < h; y += gridSize) {
    for (let x = 0; x < w; x += gridSize) {
      const sx = Math.min(x + Math.floor(gridSize / 2), w - 1);
      const sy = Math.min(y + Math.floor(gridSize / 2), h - 1);
      const i = (sy * w + sx) * 4;
      const r = data[i], g = data[i + 1], b = data[i + 2], a = data[i + 3];
      if (a > 10) {
        const hex = '#' + [r, g, b].map(c => c.toString(16).padStart(2, '0')).join('');
        if (hex.toLowerCase() !== BG.toLowerCase()) {
          pixels.push({ x, y, w: gridSize, h: gridSize, color: hex });
        }
      }
    }
  }
  return pixels;
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

async function main() {
  const canvas = document.getElementById('c');
  const size = Math.round(452 * SCALE);
  canvas.width = size;
  canvas.height = size;
  const ctx = canvas.getContext('2d');
  const grid = Math.round(PIXEL * SCALE);

  const offscreen = document.createElement('canvas');
  offscreen.width = size;
  offscreen.height = size;
  const offCtx = offscreen.getContext('2d');

  const faceImg = await svgToImage(FACE_SVG);
  offCtx.clearRect(0, 0, size, size);
  offCtx.drawImage(faceImg, 0, 0, size, size);
  const facePixels = extractPixels(offCtx, size, size, grid);

  const blinkImg = await svgToImage(BLINK_SVG);
  offCtx.clearRect(0, 0, size, size);
  offCtx.drawImage(blinkImg, 0, 0, size, size);
  const blinkPixels = extractPixels(offCtx, size, size, grid);

  shuffle(facePixels);

  ctx.fillStyle = BG;
  ctx.fillRect(0, 0, size, size);

  const PIXELS_PER_FRAME = 1;
  let faceIndex = 0;

  function drawPixel(p) {
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x, p.y, p.w, p.h);
  }

  function revealFace() {
    return new Promise(resolve => {
      function step() {
        for (let i = 0; i < PIXELS_PER_FRAME && faceIndex < facePixels.length; i++) {
          drawPixel(facePixels[faceIndex]);
          faceIndex++;
        }
        if (faceIndex < facePixels.length) {
          requestAnimationFrame(step);
        } else {
          resolve();
        }
      }
      step();
    });
  }

  let isBlinking = false;

  function drawFullFace() {
    ctx.fillStyle = BG;
    ctx.fillRect(0, 0, size, size);
    const src = isBlinking ? blinkPixels : facePixels;
    for (const p of src) drawPixel(p);
  }

  function startBlink() {
    setInterval(() => {
      isBlinking = true;
      drawFullFace();
      setTimeout(() => {
        isBlinking = false;
        drawFullFace();
      }, 150);
    }, 10000);
  }

  await revealFace();
  await new Promise(r => setTimeout(r, 500));
  startBlink();
}

main();
</script>
</body>
</html>
